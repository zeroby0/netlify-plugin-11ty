# Netlify 11ty Build Plugin

A plugin to make building with Eleventy and Netlify a joy!

### Speed up your builds âš¡
- Caches images generated by [@11ty/eleventy-img](https://github.com/11ty/eleventy-img) across builds
- Caches assets fetched by [@11ty/eleventy-cache-assets](https://github.com/11ty/eleventy-cache-assets) across builds
- Caches any other folders your choice (optional)

## Install

Install plugin via npm as dependency:

**Note**: Till https://github.com/11ty/eleventy-img/pull/116 is merged,
please use [this fork](https://github.com/zeroby0/eleventy-img/tree/cache) instead of `@11ty/eleventy-img`.

```bash
npm r @11ty/eleventy-img
npm i @zeroby0/eleventy-img
npm i netlify-plugin-11ty
```

And add the plugin to your `netlify.toml` file

```toml
[[plugins]]
    package = "netlify-plugin-11ty"
```

## Configuration

Optionally, you can configure the plugin to suit your project's needs.

**Example**:

```toml
[[plugins]]
    package = "netlify-plugin-11ty"
    [plugins.inputs]
        cache_img = './img'
        cache_img_httpHeader = true

        cache_assets = '../.cache'
        cache_other = []
```

The following `inputs` options are available:

### `cache_img`
**Type**: `String` or `Array of Strings`  
**Default**: `'./img'` (relative to the publish
directory)  

The folder(s) in which files generated by `@11ty/eleventy-img` are stored,
relative to publish directory. Can be a string or an array of strings.

If set to `false`, files generated by `@11ty/eleventy-img` are not saved in
Netlify cache.

### `cache_img_httpHeader`

**Type**: `Boolean`  
**Default**: `true`  

If set to `true`, a files generated by `@11ty/eleventy-img` will be served with
http header `cache-control: public, max-age=31536000, immutable`.

This should be safe to do as the file names have a hash calculated using file
content and Sharp Options.

### `cache_assets`

**Type**: `String` or `Array of Strings`  
**Default**: `'../.cache'` (relative to the
publish directory)  

The folder(s) in which remote assets fetched by `@11ty/eleventy-cache-assets`
are cached, relative to publish directory. Can be a string or an array of
strings.

If set to `false`, assets fetched by `@11ty/eleventy-cache-assets` are not saved
in Netlify cache.

### `cache_other`

**Type**: `String` or `Array of Strings`  
**Default**: `[]` (relative to the publish
directory)  

Any other folder(s) you'd like to cache across Netlify builds. If these folders
exist before restoring Nelify cache, they will be replaced with cached folders.

## Benchmarks
| Run                   | No cache persistence |  With cache persistence  |
|-----------------------|----------------------|--------------------------|
| 1st run (empty cache) | 11.74 seconds        | 11.52 seconds            |
| 2nd run (filled cache)| 11.32 seconds        | **131.82 milliseconds**  |

[Read more](https://github.com/11ty/eleventy-img/pull/116#issuecomment-882870369)

## Recommended Netlify plugins
- [Subfont](https://github.com/munter/netlify-plugin-subfont)
- [Inline Critical CSS](https://github.com/Tom-Bonnike/netlify-plugin-inline-critical-css#readme)

## Bugs and Feature Requests

Please [create an issue](https://github.com/zeroby0/netlify-plugin-11ty/issues/new/) :)

## License
MIT

If you need this repository with a different License,
please [create an issue](https://github.com/zeroby0/netlify-plugin-11ty/issues/new/).